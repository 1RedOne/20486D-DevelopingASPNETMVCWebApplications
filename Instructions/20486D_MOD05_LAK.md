# Module 5: Developing Views

# Lab: Developing Views 

### Lab Setup

### Preparation Steps

1.	Ensure that you have cloned the 20486D directory from GitHub. It contains the code segments for this course's labs and demos. https://github.com/MicrosoftLearning/20486D-DevelopingASPNETMVCWebApplications/tree/master/Allfiles.

2. Go to **Allfiles\Mod05\Labfiles\01_CitiesDetails_begin**, and then double-click **CitiesDetails.sln**.

## Exercise 1: Adding Views to an MVC Application

###	Task 1: Add a view to show a list of all the cities, as retrieved by the ShowCities action.

1. In the Solution Explorer pane of the **CitiesDetails - Microsoft Visual Studio** window, expand **Services**, and then click **CityProvider.cs**.
1. In the **Solution Explorer** pane of the **CitiesDetails - Microsoft Visual Studio** window, under **Services**, click **CityProvider.cs**.

```cs
    _cities = CityInitializer();
```

3. In the Solution Explorer pane of the **CitiesDetails - Microsoft Visual Studio** window, under **Services**, click **CityDetails.cs**.
4. In the **Solution Explorer** pane of the **CitiesDetails - Microsoft Visual Studio** window, under **Services**, click **CityDetails.cs**.


```cs
    _country = country;
    _city = city;
    _timeZone = timeZone;
    _cityPopulation = cityPopulation;
```

5. In the Solution Explorer pane of the **CitiesDetails - Microsoft Visual Studio** window, under **Services**, click **CityPopulation.cs**.
7. In the **Solution Explorer** pane of the **CitiesDetails - Microsoft Visual Studio** window, under **Services**, click **CityPopulation.cs**.

```cs
    _year = year;
    _city = city;
    _urban = urban;
    _metro = metro;
```

7. In the Solution Explorer pane of the **CitiesDetails - Microsoft Visual Studio** window, expand **Controllers**, and then click **CityController.cs**.
10. In the **Solution Explorer** pane of the **CitiesDetails - Microsoft Visual Studio** window, under **Controllers**, click **CityController.cs**.

```cs
    public IActionResult ShowCities()
```



```cs
    @using CitiesDetails.Services
    @inject ICityProvider CityProvider
```

```cs
    <title>ShowCities</title>
```

```cs
    <link href="~/css/StyleSheet.css" rel="stylesheet" />
```

```cs
    <h1>Select City</h1>
    @foreach (var item in CityProvider)
    {
        <p>@item.Key</p>
    }
```

###	Task 2: Run the application.

1. On the **DEBUG** menu of the **CitiesDetails - Microsoft Visual Studio** window, click **Start Debugging**.

2. In the **Microsoft Edge** window, click **Close**.


###	Task 3: Add a view to show data for a city, as returned by the ShowDataForCity action.

1. In the Solution Explorer pane of the **CitiesDetails - Microsoft Visual Studio** window, under **Controllers**, click **CityController.cs**.
1. In the **Solution Explorer** pane of the **CitiesDetails - Microsoft Visual Studio** window, under **Controllers**, click **CityController.cs**.

```cs
    using Microsoft.AspNetCore.Mvc;
```

```cs
    using CitiesDetails.Services;
```

```cs
    public class CityController : Controller
    {
```

5. Place the mouse cursor at the end of the code, press Enter, type the following code, and press enter again.
```cs
    ICityProvider _cities;
```

```cs
    public CityController()

```

```cs
```

9. In the **CityController.cs** code window, select the following code. 
```cs
    public IActionResult ShowDataForCity()
```

```cs
    public IActionResult ShowDataForCity(string city)
```

```cs
    public IActionResult ShowDataForCity(string city)
    {
```

```cs
    ViewBag.City = _cities[city];
```

```cs
```



```cs
```

```cs
```

```cs
    </div>
```



```cs
    return Content(cityName);
```

```cs
    return File($@"images\{cityName}.jpg", "image/jpeg");
```

###	Task 4: Add a Back link to the ShowDataForCity view. Pressing the link will redirect to the ShowCities action.


```cs
    <span><img src="@Url.Action("GetImage", new {cityName = ViewBag.City._city })" /></span>
```

```cs
    <br /><a asp-action="ShowCities">Back</a>
```

4. In the Solution Explorer pane of the **CitiesDetails - Microsoft Visual Studio** window, right-click **Views**, point to **Add**, and then click **New Item**.
4. In the **Solution Explorer** pane of the **CitiesDetails - Microsoft Visual Studio** window, right-click **Views**, point to **Add**, and then click **New Item**.


```cs
    @addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
```

###	Task 5: Add a “Show data” link next to each city in the ShowCities view. Pressing the link will trigger a redirect to the ShowDataForCity action.


```cs
    <p>@item.Key</p>
```

```cs
    <h2><a asp-action="ShowDataForCity" asp-route-city="@item.Key">@item.Key</a></h2>
```

###	Task 6: Run the application.


2.  In the **Microsoft Edge** window, click the **London** link.

3. In the **Microsoft Edge** window, click the **Back** link.

4. In the **Microsoft Edge** window, click **Close**.


##	Exercise 2: Adding a partial view

###	Task 1: Add a partial view.



3. In the Solution Explorer pane of the **CitiesDetails - Microsoft Visual Studio** window, right-click **Shared**, point to **Add**, and then click **View...**.
3. In the **Solution Explorer** pane, right-click **Shared**, point to **Add**, and then click **View**.



    @*
        For more information on enabling MVC for empty projects, visit http://go.microsoft.com/fwlink/?LinkID=397860
    *@
```

7. In the **_CityPopulation.cshtml** code window, place the mouse cursor at the beginning of the document, and then type the following code. 
7. In the **SelectCity.cshtml** code window, place the cursor at the beginning of the document, and then type the following code:
```cs
    @{ 
        CitiesDetails.Services.CityPopulation population = ViewBag.City._cityPopulation;
    }

    <p><h3>City Population(@population._year)</h3></p>
    <p>City: @population._city</p>
    <p>Urban: @population._urban</p>
    <p>Metro: @population._metro</p>
```

###	Task 2: Use the partial view in the ShowDataForCity view.

1. In the Solution Explorer pane of the **CitiesDetails - Microsoft Visual Studio** window, under **Views**, under **City**, click **ShowDataForCity.cshtml**.
1. In the **Solution Explorer** pane of the **CitiesDetails - Microsoft Visual Studio** window, under **Views**, under **City**, click **ShowDataForCity.cshtml**.

```cs
    <span><img src="@Url.Action("GetImage", new {cityName = ViewBag.City._city })" /></span>
```

```cs
    @Html.Partial("_CityPopulation")
```

###	Task 3: Run the application.

1. On the **DEBUG** menu of the **CitiesDetails - Microsoft Visual Studio** window, click **Start Debugging**.



##	Exercise 3: Adding a view component

###	Task 1: Add a view component class.



3. In the Solution Explorer pane of the **CitiesDetails - Microsoft Visual Studio** window, right-click **ViewComponents**, point to **Add**, and then click **Class**.
3. In the **Solution Explorer** pane of the **CitiesDetails - Microsoft Visual Studio** window, right-click **ViewComponents**, point to **Add**, and then click **Class**.


```cs
    using System.Threading.Tasks;
``` 

```cs
    using Microsoft.AspNetCore.Mvc;
```

```cs
    public class CityViewComponent
```

```cs
```

```cs
    public IViewComponentResult Invoke(string cityName)
    {
        
    }
```

10. Place the cursor within the **Invoke** method code block, and then type the following code:
```cs
    ViewBag.CurrentCityName = cityName;
    return View("SelectCity");
```

###	Task 2: Add a view component view.

1. In the Solution Explorer pane of the **CitiesDetails - Microsoft Visual Studio** window, under **Views**, right-click the **Shared**, point to **Add**, and then click **New Folder**.
1. In the **Solution Explorer** pane of the **CitiesDetails - Microsoft Visual Studio** window, under **Views**, right-click the **Shared**, point to **Add**, and then click **New Folder**.

2. In the Solution Explorer pane, rename **New Folder** as **Components**, and then press Enter.
2. In the **Solution Explorer** pane, rename **New Folder** as **Components**, and then press Enter.

3. In the Solution Explorer pane of the **CitiesDetails - Microsoft Visual Studio** window, right-click **Components**, point to **Add**, and then click **New Folder**.
3. In the **Solution Explorer** pane of the **CitiesDetails - Microsoft Visual Studio** window, right-click **Components**, point to **Add**, and then click **New Folder**.

4. In the Solution Explorer pane, rename **New Folder** as **City**, and then press Enter.

5. In the **Solution Explorer** pane of the **CitiesDetails - Microsoft Visual Studio** window, right-click **City**, point to **Add**, and then click **View**.
    
6. In the **Add MVC View** dialog window, in the **View name** textbox, type: **SelectCity**.

7. In the **Add MVC View** dialog window, verify that only the **Create as a partial view** checkbox is marked, and press **Add**.

```cs
    @*
        For more information on enabling MVC for empty projects, visit http://go.microsoft.com/fwlink/?LinkID=397860
    *@
```

9. In the **SelectCity.cshtml** code window, place the mouse cursor at the beginning of the document, and then type the following code.  
```cs
    <div>
        <h2>
            <a asp-action="ShowDataForCity" asp-route-city=@ViewBag.CurrentCityName>@ViewBag.CurrentCityName</a>
        </h2>
        <img src="@Url.Action("GetImage", new {cityName = ViewBag.CurrentCityName })" />
    </div>
```

###	Task 3: Use the view component.

1. In the Solution Explorer pane of the **CitiesDetails - Microsoft Visual Studio** window, under **Views**, under **City**, click **ShowCities.cshtml**.
1. In the **Solution Explorer** pane of the **CitiesDetails - Microsoft Visual Studio** window, under **Views**, under **City**, click **ShowCities.cshtml**.

```cs
    <h2><a asp-action="ShowDataForCity" asp-route-city="@item.Key">@item.Key</a></h2>
```

```cs
    @await Component.InvokeAsync("City", item.Key)
```

###	Task 4: Run the application.

1. On the **DEBUG** menu of the **CitiesDetails - Microsoft Visual Studio** window, click **Start Debugging**.


